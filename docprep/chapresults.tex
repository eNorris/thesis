%%
%% Edward T. Norris
%% Discrete Ordinates Computed Tomography Organ Dose Simulator (DOCTORS)
%% 
%% === Results ===
%%


\section{Preprocessing}
Two computational phantoms were used for verification of the DOCTORS code.

Some preprocessing was done to each phantom before it was used in DOCTORS to provide results.

The results from DOCTORS were compared to analagous results from MCNP6. The MCNP6 reference compared to is automatically generated by DOCTORS to guarantee that the geometry and source parameters are identical. This process is described in detail in Section~\ref{sec:mcnpgen}.

First subtract 1024 to account for the unsigned 16-bit int data structure.

\subsection{Artifact Removal}
At the periphery of the computational mesh, artifacts can appear as a byproduct of the reconstruction algorithm used. Figure~\ref{fig:phantomWaterUnmodified} shows the artifacts in question in a $sy$ slice at the lowest ($z = 0$) level in the phantom. Two hundred sixty one (261) artifacts were detected in the phantom. To remove these artifacts, the CT number of any voxels whose CT number was greater than or equal to 65500 was set to 0. Figure~\ref{fig:phantomWaterModified} shows the same cross sectional plot after the artifacts are removed.

The water phantom in Fig.~\ref{fig:phantomWaterModified} can be broken into four regions: the water phantom, the container, the air, and the corner artifacts. The water phantom is the centermost region of the slice

\begin{figure}[tb]
  \begin{center}
   \includegraphics[width=3.75in]{figs/phantomWaterUnmodified}
  \end{center}
  \caption{The unmodified phantom. An $xy$ slice at $z$ index = 0.}
\label{fig:phantomWaterUnmodified}
\end{figure}

\begin{figure}[tb]
  \begin{center}
   \includegraphics[width=3.75in]{figs/phantomWaterModified}
  \end{center}
  \caption{The phantom after artifacts are removed. An $xy$ slice at $z$ index = 0.}
\label{fig:phantomWaterModified}
\end{figure}

\subsection{Gantry Handling}
In some phantom models, a gantry is present. The gantry poses a challenge since it is a highly attenuating material relative to the patient which reduces the available flux.

The CT number to material conversion developed by~\cite{ref:ottossonr} which is implemented in this work does not have an equivalent for the gantry region.

\subsection{Geometry Simplification}
The original phantom data for both the water phantom and the liver phantom are $256\times256\times64$ meshes which result in 4,194,304 total voxels. Though MCNP6 is capable of running such a mesh, the overhead of loading the mesh into memory and initiating the Monte Carlo solver can take on the order of hours. Therefore, the benchmarks were run using a simplified geometry of $64\times64\times16$ which has only 65,536 voxels. The smaller files can run to completion of $10^9$ particles within two hours.

\begin{figure}[tb]
  \begin{center}
   \includegraphics[width=3.75in]{figs/waterPhantom256}
  \end{center}
  \caption{Raw CT number data for the $256 \times 256 \times 64$ water phantom.}
\label{fig:waterPhantom256}
\end{figure}

\begin{figure}[tb]
  \begin{center}
   \includegraphics[width=3.75in]{figs/waterPhantom64}
  \end{center}
  \caption{The small one}
\label{fig:waterPhantom64}
\end{figure}

\section{Cone-Beam Water Benchmark}

The first benchmark, the cone with 19 groups is given in Fig. 1. The cross section data for the water and air regions are shown in Fig.~\ref{fig:airwater19}.

The water phantom is a 35 cm diameter water cylinder that stands 12.5 inches tall. The water is encased in a 0.5 cm thick plastic container.

\begin{table}[ht]
\caption{Water Regions}
\centering 
\begin{tabular}{l c r r}
\hline \hline   
Region    & CT Range & Voxels & Fraction (\%)\\ [0.5ex] 
\hline
Water     & $0 \leq x < 67$ & 1581199 & 37.70 \\
Container & $67 \leq x < 600$ & 81502 & 1.94 \\
Air       & $600 \leq x < 1080$ & 1650372  & 39.35 \\
Artifact  & $1080 \leq x < 65535$ & 881231 & 21.01 \\  [1ex]
\hline
\end{tabular}
\label{table:nonlin}
\end{table}

Once the artifacts are removed, the histogram is plotted. Figure~\ref{fig:waterHist} shows two versions of the water histogram, \ref{fig:waterHistLin} on a linear scale and \ref{fig:waterHistLog} on a logarithmic scale.

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/waterHistogramLin}
        \caption{Linear}
        \label{fig:waterHistLin}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/waterHistogramLog}
        \caption{Logarithmic}
        \label{fig:waterHistLog}
    \end{subfigure}
    \caption{The histogram.}\label{fig:waterHist}
\end{figure}

Due to the meshing used in CT phantoms, the spatial domain of the problem is identical for both the deterministic and Monte Carlo problems. A key difference between though is the group structure used in the group-averaged deterministic cross sections. Figure~\ref{fig:airwarerxs} shows the continuous energy macroscopic cross section for both air and water versus the discretized data used by DOCTORS. Unfortunately, the datasets used in DOCTORS originate from SCALE6.2, a light water reactor analysis code. Therefore, their upper photon energy bound is 20 MeV which is far higher than necessary for diagnostic imaging. This results in the region of interesting being discretized very roughly. In the 19-group discretization, the entire diagnostic domain is covered by only three energy groups.

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/airwaterxs2_19group}
        \caption{19 Groups}
        \label{fig:airwaterxs19}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/airwaterxs2_47group}
        \caption{47 Groups}
        \label{fig:airwaterxs47}
    \end{subfigure}
    \caption{Comparison of the group cross section data used by DOCTORS to the continuous cross section data used by MCNP6. The continuous data is provided by NIST !!!CITE!!!.}\label{fig:airwaterxs}
\end{figure}


The detailed flux distribution from MCNP6 and the solver are not included here, they are provided in Appendix~\ref{sec:appc_benchmark}.

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/bench_cone1_comp}
        \caption{10 - 20 MeV.}
        \label{fig:bench_cone1_comp}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/bench_cone1_lineout}
        \caption{10 - 20 MeV lineout.}
        \label{fig:bench_cone1_lineout}
    \end{subfigure}
    
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/bench_cone1_comp_g17}
        \caption{100 - 200 keV.}
        \label{fig:bench_cone1_comp_g17}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/bench_cone1_lineout_g17}
        \caption{100 - 200 keV lineout.}
        \label{fig:bench_cone1_lineout_g17}
    \end{subfigure}
    
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/bench_cone1_comp_g18}
        \caption{45 - 100 keV.}
        \label{fig:bench_cone1_comp_g18}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/bench_cone1_lineout_g18}
        \caption{45 - 100 keV lineout.}
        \label{fig:bench_cone1_lineout_g18}
    \end{subfigure}
    
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/bench_cone1_comp_g19}
        \caption{10 - 45 keV.}
        \label{fig:bench_cone1_comp_g19}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/bench_cone1_lineout_g19}
        \caption{10 - 45 keV lineout.}
        \label{fig:bench_cone1_lineout_g19}
    \end{subfigure}
    \caption{Comparison of the MCNP6 results and the raytracer.}\label{fig:waterHist}
\end{figure}

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/bench_cone1_centerdiff}
        \caption{}
        \label{fig:bench_cone1_centerdiff}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{figs/bench_cone1_centerdiff2}
        \caption{}
        \label{fig:bench_cone1_centerdiff2}
    \end{subfigure}
    \caption{Comparison}\label{fig:bench_cone1_centerdifffig}
\end{figure}

\begin{figure}[tb]
  \begin{center}
   \includegraphics[width=3.75in]{figs/bench_cone1_centerdiff3}
  \end{center}
  \caption{The 19 group center flux comparison}
\label{fig:bench_cone1_centerdiff3}
\end{figure}

A plot is below.

\begin{figure}[tb]
  \begin{center}
   \includegraphics[width=3.75in]{figs/bench_cone1_centerdiff47}
  \end{center}
  \caption{The 47 group center flux comparison}
\label{fig:bench_cone1_centerdiff47}
\end{figure}

The analytical points are computed
\begin{equation}
\left(\frac{d\varphi}{dE}\right)^g = \frac{e^{-(\mu^g_a x_a + \mu^g_w x_w)}}{4\pi G (x_a + x_w)^2 (\Delta E)^g}
\end{equation}
where $\mu_a^g$ and $\mu_w^g$ are the attenuation coefficients for air and water repectively for the $g$ group, $x_a$ and $x_w$ are the pathlength through air and water respectively, and $\Delta E$ is the width of the $g$ group in MeV. Dividing by the number of groups maintains consistency with the computational codes which uniformly distribute particles across all groups.

\section{16 Cone-Beam Water Benchmark}

And now 16.

\section{16 Cone-beam Phantom Benchmark}

It's a person!

\section{GPU Acceleration}

it's faster!


\endinput
%%
%% End of file `chapmin.tex'.
